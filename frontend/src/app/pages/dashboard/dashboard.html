<app-sidebar />

<div class="main-content">
  <div class="container">
    @if (loading) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading metrics...</p>
    </div>
    } @else if (error) {
    <div class="error-state">
      <p>{{ error }}</p>
      <button class="btn-primary" (click)="ngOnInit()">Retry</button>
    </div>
    } @else {
    <div class="metrics-grid">
      <!-- CPU Card -->
      <app-metric-card
        icon="üñ•Ô∏è"
        title="CPU Usage"
        [value]="metrics?.cpu?.usage ?? '--'"
        unit="%"
        [details]="cpuDetails"
        [progress]="metrics?.cpu?.usage"
      />

      <!-- Memory Card -->
      <app-metric-card
        icon="üíæ"
        title="RAM Memory"
        [value]="metrics?.memory?.usagePercent ?? '--'"
        unit="%"
        [details]="memoryDetails"
        [progress]="metrics?.memory?.usagePercent"
        [progressWarning]="(metrics?.memory?.usagePercent || 0) > 80"
      />

      <!-- Disk Card -->
      <app-metric-card
        icon="üíø"
        title="Disk"
        [value]="metrics?.disk?.usagePercent ?? '--'"
        unit="%"
        [details]="diskDetails"
        [progress]="metrics?.disk?.usagePercent"
        [progressWarning]="(metrics?.disk?.usagePercent || 0) > 80"
      />

      <!-- Network Card -->
      <app-metric-card
        icon="üåê"
        title="Network"
        [value]="metrics?.network?.rx?.toFixed(1) ?? '--'"
        unit="KB/s ‚Üì"
        [details]="networkDetails"
      />

      <!-- System Load Card -->
      <app-metric-card
        icon="‚öôÔ∏è"
        title="System Load"
        [value]="metrics?.system?.loadAvg?.[0]?.toFixed(2) || '--'"
        [details]="systemLoadDetails"
      />

      <!-- System Info Card -->
      <div class="metric-card system-info-card">
        <div class="metric-header">
          <div class="metric-icon">‚ÑπÔ∏è</div>
          <div class="metric-title">System Info</div>
        </div>

        @if (systemInfo) {
        <div class="uptime-display">
          <span class="label">Uptime</span>
          <span class="value">{{ formatUptime(systemInfo.os?.uptime || 0) }}</span>
        </div>

        <div class="system-details">
          <div class="detail-row">
            <span>üñ•Ô∏è Host</span>
            <span>{{ systemInfo.os?.hostname || '--' }}</span>
          </div>
          <div class="detail-row">
            <span>üêß OS</span>
            <span>{{ systemInfo.os?.platform || '--' }}</span>
          </div>
          <div class="detail-row">
            <span>‚öôÔ∏è Kernel</span>
            <span>{{ systemInfo.os?.release || '--' }}</span>
          </div>
        </div>
        }

        <div class="settings-toggle">
          <label class="toggle-label">
            <span>üîÑ Auto-Update</span>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                [checked]="autoUpdateEnabled" 
                (change)="toggleAutoUpdate($event)"
              />
              <span class="slider"></span>
            </div>
          </label>
        </div>

        <div class="admin-buttons">
          <button class="btn-restart" (click)="restartServer()">üîÑ Restart</button>
          <button class="btn-shutdown" (click)="shutdownServer()">‚õî Shutdown</button>
        </div>
      </div>

      <!-- LED Control Card -->
      @if (ledStatus && ledStatus.available) {
      <div class="metric-card led-control-card">
        <div class="metric-header">
          <div class="metric-icon">üí°</div>
          <div class="metric-title">Power LED</div>
        </div>

        <div class="led-status">
          <div class="detail-row">
            <span>Status</span>
            <span class="status-badge" [class.enabled]="ledStatus.config.enabled">
              {{ ledStatus.config.enabled ? 'Enabled' : 'Disabled' }}
            </span>
          </div>
          @if (ledStatus.config.enabled) {
          <div class="detail-row">
            <span>Mode</span>
            <span>{{ ledStatus.config.mode }}</span>
          </div>
          <div class="detail-row">
            <span>Current</span>
            <span>{{ ledStatus.currentTrigger || '--' }}</span>
          </div>
          }
        </div>

        <div class="led-controls">
          <button
            class="btn-toggle"
            [class.active]="ledStatus.config.enabled"
            [disabled]="ledLoading"
            (click)="toggleLed()"
          >
            {{ ledStatus.config.enabled ? '‚úì Enabled' : 'Enable Activity Display' }}
          </button>

          @if (ledStatus.config.enabled) {
          <div class="led-modes">
            <label>Activity Mode:</label>
            <select
              [value]="ledStatus.config.mode"
              (change)="changeLedMode($any($event.target).value)"
              [disabled]="ledLoading"
            >
              <option value="mmc0">SD Card Activity</option>
              <option value="heartbeat">Heartbeat</option>
              <option value="actpwr">Activity + Power</option>
            </select>
          </div>
          }
        </div>
      </div>
      }

      <!-- Sessions Card -->
      <app-sessions-card />

      <!-- Terminal Card -->
      <app-terminal-card />
    </div>

    <div class="timestamp">Last updated: {{ lastUpdate }}</div>
    }
  </div>
</div>
