<app-sidebar />

<div class="main-content">
  <div class="container">
    @if (loading) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading metrics...</p>
    </div>
    } @else if (error) {
    <div class="error-state">
      <p>{{ error }}</p>
      <button class="btn-primary" (click)="ngOnInit()">Retry</button>
    </div>
    } @else {
    <div class="metrics-grid">
      <!-- Compact Metrics Row -->
      <div class="compact-metrics">
        <!-- CPU Card -->
        <app-metric-card
          icon="üñ•Ô∏è"
          title="CPU Usage"
          [value]="metrics?.cpu?.usage ?? '--'"
          unit="%"
          [details]="cpuDetails"
          [progress]="metrics?.cpu?.usage"
        />

        <!-- Memory Card -->
        <app-metric-card
          icon="üíæ"
          title="RAM Memory"
          [value]="metrics?.memory?.usagePercent ?? '--'"
          unit="%"
          [details]="memoryDetails"
          [progress]="metrics?.memory?.usagePercent"
          [progressWarning]="(metrics?.memory?.usagePercent || 0) > 80"
        />

        <!-- Disk Card -->
        <app-metric-card
          icon="üíø"
          title="Disk"
          [value]="metrics?.disk?.usagePercent ?? '--'"
          unit="%"
          [details]="diskDetails"
          [progress]="metrics?.disk?.usagePercent"
          [progressWarning]="(metrics?.disk?.usagePercent || 0) > 80"
        />

        <!-- Network Card -->
        <app-metric-card
          icon="üåê"
          title="Network"
          [value]="metrics?.network?.rx?.toFixed(1) ?? '--'"
          unit="KB/s ‚Üì"
          [details]="networkDetails"
        />

        <!-- System Load Card -->
        <app-metric-card
          icon="‚öôÔ∏è"
          title="System Load"
          [value]="metrics?.system?.loadAvg?.[0]?.toFixed(2) || '--'"
          [details]="systemLoadDetails"
        />
      </div>

      <!-- Feature Cards Section -->
      <div class="feature-cards">
        <!-- System Info Card -->
        <div class="metric-card system-info-card">
          <div class="metric-header">
            <div class="metric-icon">‚ÑπÔ∏è</div>
            <div class="metric-title">System Info</div>
          </div>

          @if (systemInfo) {
          <div class="uptime-display">
            <span class="label">Uptime</span>
            <span class="value">{{ formatUptime(systemInfo.os?.uptime || 0) }}</span>
          </div>

          <div class="system-details">
            <div class="detail-row">
              <span>üñ•Ô∏è Host</span>
              <span>{{ systemInfo.os?.hostname || '--' }}</span>
            </div>
            <div class="detail-row">
              <span>üêß OS</span>
              <span>{{ systemInfo.os?.platform || '--' }}</span>
            </div>
            <div class="detail-row">
              <span>‚öôÔ∏è Kernel</span>
              <span>{{ systemInfo.os?.release || '--' }}</span>
            </div>
          </div>
          }

          <div class="settings-toggle">
            <label class="toggle-label">
              <span>üîÑ Auto-Update</span>
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  [checked]="autoUpdateEnabled"
                  (change)="toggleAutoUpdate($event)"
                />
                <span class="slider"></span>
              </div>
            </label>
          </div>

          <div class="admin-buttons">
            <button class="btn-restart" (click)="restartServer()">üîÑ Restart</button>
            <button class="btn-shutdown" (click)="shutdownServer()">‚õî Shutdown</button>
          </div>
        </div>

        <!-- LED Control Card -->
        @if (ledStatus) {
        <div class="metric-card led-control-card" [class.unavailable]="!ledStatus.available">
          <div class="metric-header">
            <div class="metric-icon">üí°</div>
            <div class="metric-title">Power LED Activity</div>
          </div>

          @if (ledError) {
          <div class="led-error">{{ ledError }}</div>
          }
          
          @if (ledStatus.available) {
          <div class="led-status-row">
            <div class="led-status-item">
              <span class="label">Status</span>
              <span 
                class="badge"
                [class.badge-success]="ledStatus.config.enabled"
                [class.badge-secondary]="!ledStatus.config.enabled"
              >
                {{ ledStatus.config.enabled ? 'Active' : 'Idle' }}
              </span>
            </div>
            <div class="led-status-item">
              <span class="label">Current mode</span>
              <span class="value">{{ ledStatus.currentTrigger || 'default-on' }}</span>
            </div>
          </div>

          <div class="led-controls">
            <button
              class="btn-toggle"
              [class.active]="ledStatus.config.enabled"
              [disabled]="ledLoading"
              (click)="toggleLed()"
            >
              {{
                ledStatus.config.enabled ? 'Disable' : 'Enable'
              }}
            </button>

            <div class="led-mode-selector">
              <label>Pattern</label>
              <select
                [value]="ledStatus.config.mode"
                (change)="changeLedMode($any($event.target).value)"
                [disabled]="ledLoading"
              >
                @for (option of ledModeOptions; track option.value) {
                <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
            </div>
          </div>
          } @else {
          <div class="led-unavailable">
            <div class="title">LED interface not available</div>
            <p>
              We could not find a controllable power LED on this device. If you are running on a
              Raspberry Pi, make sure the server has permission to write to /sys/class/leds.
            </p>
          </div>
          } @if (ledLoading) {
          <div class="led-overlay">
            <div class="loading-spinner"></div>
            <span>Updating...</span>
          </div>
          }
        </div>
        }

        <!-- Sessions Card -->
        <app-sessions-card />
      </div>

      <!-- Full Width Cards Section -->
      <div class="full-width-cards">
        <!-- Terminal Card -->
        <app-terminal-card />
      </div>
    </div>

    <div class="timestamp">Last updated: {{ lastUpdate }}</div>
    }
  </div>
</div>
