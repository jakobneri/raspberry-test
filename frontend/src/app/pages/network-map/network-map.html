<div class="network-layout">
  <app-sidebar></app-sidebar>

  <main class="network-main">
    <header class="network-header">
      <div class="header-content">
        <h1>üåê Network Map</h1>
        <div class="header-actions">
          <button class="btn btn-primary" (click)="scanNetwork()" [disabled]="scanning">
            @if (scanning) {
            <span class="spinner"></span> Scanning... } @else { üîç Scan Network }
          </button>
        </div>
      </div>

      @if (lastScan) {
      <p class="last-scan">Last scan: {{ lastScan | date : 'medium' }}</p>
      }
    </header>

    <!-- Stats Cards -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon">üì°</div>
        <div class="stat-info">
          <span class="stat-value">{{ devices.length }}</span>
          <span class="stat-label">Total Devices</span>
        </div>
      </div>
      <div class="stat-card online">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-info">
          <span class="stat-value">{{ onlineCount }}</span>
          <span class="stat-label">Online</span>
        </div>
      </div>
      <div class="stat-card offline">
        <div class="stat-icon">‚ùå</div>
        <div class="stat-info">
          <span class="stat-value">{{ offlineCount }}</span>
          <span class="stat-label">Offline</span>
        </div>
      </div>
    </div>

    <!-- Topology Map -->
    <section class="topology-section">
      <h2>Topology</h2>
      <div class="topology-legend">
        <span class="legend-item wired"><span class="dot"></span>Wired</span>
        <span class="legend-item wireless"><span class="dot"></span>Wireless</span>
        <span class="legend-item unknown"><span class="dot"></span>Unknown</span>
      </div>
      <div class="topology-card">
        <svg class="topology-lines" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
          @for (node of topologyNodes; track node.mac) {
          <line
            x1="50"
            y1="50"
            [attr.x2]="node.x"
            [attr.y2]="node.y"
            class="topology-line"
            [class.wireless]="node.connection === 'wireless'"
            [class.wired]="node.connection === 'wired'"
          />
          }
        </svg>

        <div class="topology-center">
          <div class="hub-icon">üõ∞Ô∏è</div>
          <div class="hub-label">Gateway</div>
        </div>

        @for (node of topologyNodes; track node.mac) {
        <div
          class="topology-node"
          [class.online]="node.status === 'online'"
          [class.offline]="node.status === 'offline'"
          [class.wireless]="node.connection === 'wireless'"
          [class.wired]="node.connection === 'wired'"
          [style.left]="node.x + '%'"
          [style.top]="node.y + '%'"
        >
          <div class="node-icon">üñ•Ô∏è</div>
          <div class="node-host">{{ node.hostname || 'Unknown' }}</div>
          <div class="node-ip">{{ node.ip }}</div>
          <div class="node-mac">{{ node.mac }}</div>
          <div class="node-type">
            {{
              node.connection === 'wired'
                ? 'Wired'
                : node.connection === 'wireless'
                ? 'Wireless'
                : 'Unknown'
            }}
          </div>
        </div>
        }
      </div>
    </section>

    <!-- Devices Grid -->
    <section class="devices-section">
      <h2>Discovered Devices</h2>

      @if (loading) {
      <div class="loading-state">
        <span class="spinner"></span>
        <p>Loading devices...</p>
      </div>
      } @else if (devices.length === 0) {
      <div class="empty-state">
        <p>No devices found. Click "Scan Network" to discover devices.</p>
      </div>
      } @else {
      <div class="devices-grid">
        @for (device of devices; track index; let index = $index) {
        <div class="device-card" [class]="getStatusColor(device.status)">
          <div class="device-status">
            <span class="status-dot" [class]="device.status"></span>
            <span class="status-text">{{ device.status }}</span>
          </div>

          <div class="device-icon">üñ•Ô∏è</div>

          <div class="device-info">
            <h3 class="device-hostname">{{ device.hostname || 'Unknown' }}</h3>
            <p class="device-ip">{{ device.ip }}</p>
          </div>

          <div class="device-details">
            <div class="detail-row">
              <span class="label">MAC:</span>
              <span class="value">{{ device.mac }}</span>
            </div>
            @if (device.vendor) {
            <div class="detail-row">
              <span class="label">Vendor:</span>
              <span class="value">{{ device.vendor }}</span>
            </div>
            }
            <div class="detail-row">
              <span class="label">Last Seen:</span>
              <span class="value">{{ formatLastSeen(device.lastSeen) }}</span>
            </div>
          </div>
        </div>
        }
      </div>
      }
    </section>
  </main>
</div>
