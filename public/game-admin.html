<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Game Admin - Pi Cockpit</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/cockpit.css" />
    <link rel="stylesheet" href="css/game-admin.css" />
  </head>
  <body>
    <!-- Left Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h1>ü•ß Pi Cockpit</h1>
        <div class="subtitle">Raspberry Pi Server</div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Main</div>
          <a href="/cockpit" class="nav-link">
            <span class="nav-link-icon">üìä</span>
            <span>Dashboard</span>
          </a>
          <a href="/users" class="nav-link">
            <span class="nav-link-icon">üë•</span>
            <span>User Management</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Pages</div>
          <a href="/files" class="nav-link">
            <span class="nav-link-icon">üìÅ</span>
            <span>Files</span>
          </a>
          <a href="/game" class="nav-link">
            <span class="nav-link-icon">üéÆ</span>
            <span>Game</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Admin Pages</div>
          <a href="/game-admin" class="nav-link active">
            <span class="nav-link-icon">‚öôÔ∏è</span>
            <span>Game Admin</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">System</div>
          <a href="#" class="nav-link" onclick="logout(); return false;">
            <span class="nav-link-icon">üö™</span>
            <span>Logout</span>
          </a>
        </div>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="container">
        <div class="header">
          <h1>Game Administration</h1>
        </div>

        <!-- Difficulty Section -->
        <div class="difficulty-card">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 15px;
            "
          >
            <h2>üéÆ Schwierigkeit</h2>
            <span
              style="
                font-size: 12px;
                color: #888;
                background: #f0f0f0;
                padding: 4px 8px;
                border-radius: 4px;
              "
              >Aktuell: <span id="current-difficulty">Normal</span></span
            >
          </div>
          <div class="difficulty-options">
            <button
              class="difficulty-btn"
              onclick="setDifficulty('easy')"
              id="diff-easy"
            >
              <div style="font-size: 24px; margin-bottom: 5px">üê¢</div>
              <div>Einfach</div>
              <div
                style="
                  font-size: 0.8em;
                  font-weight: normal;
                  margin-top: 5px;
                  opacity: 0.7;
                "
              >
                Langsam
              </div>
            </button>
            <button
              class="difficulty-btn active"
              onclick="setDifficulty('medium')"
              id="diff-medium"
            >
              <div style="font-size: 24px; margin-bottom: 5px">üêá</div>
              <div>Mittel</div>
              <div
                style="
                  font-size: 0.8em;
                  font-weight: normal;
                  margin-top: 5px;
                  opacity: 0.7;
                "
              >
                Normal
              </div>
            </button>
            <button
              class="difficulty-btn"
              onclick="setDifficulty('hard')"
              id="diff-hard"
            >
              <div style="font-size: 24px; margin-bottom: 5px">üêÜ</div>
              <div>Schwer</div>
              <div
                style="
                  font-size: 0.8em;
                  font-weight: normal;
                  margin-top: 5px;
                  opacity: 0.7;
                "
              >
                Schnell
              </div>
            </button>
          </div>
        </div>

        <!-- Scoreboard Section -->
        <div class="scoreboard-section">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 15px;
            "
          >
            <h2>üèÜ Pi Runner - Top Scores</h2>
            <button
              onclick="resetScoreboard()"
              style="
                background: #ff6b6b;
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 12px;
              "
            >
              üóëÔ∏è Reset
            </button>
          </div>
          <table class="score-table">
            <thead>
              <tr>
                <th>Rang</th>
                <th>Score</th>
                <th>Datum</th>
              </tr>
            </thead>
            <tbody id="scoreboard-body">
              <tr>
                <td colspan="3" style="text-align: center; color: #999">
                  Lade Scoreboard...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      // Initial fetch
      fetchScoreboard();

      // Update scoreboard every 10 seconds
      setInterval(fetchScoreboard, 10000);

      async function fetchScoreboard() {
        try {
          const response = await fetch("/api/scores");
          if (response.ok) {
            const scores = await response.json();
            updateScoreboard(scores);
          }
        } catch (error) {
          console.error("Error loading scoreboard:", error);
        }
      }

      function updateScoreboard(scores) {
        const tbody = document.getElementById("scoreboard-body");

        if (scores.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="3" style="text-align: center; color: #999;">Noch keine Scores</td></tr>';
          return;
        }

        const medals = ["ü•á", "ü•à", "ü•â"];
        tbody.innerHTML = scores
          .map((score, index) => {
            const date = new Date(score.timestamp);
            const medal = index < 3 ? medals[index] : `#${index + 1}`;
            return `
            <tr>
              <td><span class="rank-medal">${medal}</span></td>
              <td><span class="score-value">${score.score}</span></td>
              <td>${date.toLocaleDateString("de-DE")} ${date.toLocaleTimeString(
              "de-DE",
              { hour: "2-digit", minute: "2-digit" }
            )}</td>
            </tr>
          `;
          })
          .join("");
      }

      function setDifficulty(level) {
        // Update UI
        document
          .querySelectorAll(".difficulty-btn")
          .forEach((btn) => btn.classList.remove("active"));
        document.getElementById("diff-" + level).classList.add("active");

        const labels = { easy: "Einfach", medium: "Mittel", hard: "Schwer" };
        const labelEl = document.getElementById("current-difficulty");
        if (labelEl) labelEl.textContent = labels[level] || level;

        // TODO: Save to server
        console.log("Difficulty set to:", level);
      }

      async function resetScoreboard() {
        if (!confirm("M√∂chten Sie wirklich alle Scores l√∂schen?")) {
          return;
        }

        try {
          const response = await fetch("/api/scores", { method: "DELETE" });
          if (response.ok) {
            loadScores(); // Reload the empty table
          } else {
            alert("Fehler beim Zur√ºcksetzen der Scores");
          }
        } catch (e) {
          console.error(e);
          alert("Fehler beim Zur√ºcksetzen der Scores");
        }
      }

      async function logout() {
        try {
          await fetch("/api/logout", { method: "POST" });
          window.location.href = "/";
        } catch (error) {
          console.error("Error during logout:", error);
          window.location.href = "/";
        }
      }
    </script>
  </body>
</html>
